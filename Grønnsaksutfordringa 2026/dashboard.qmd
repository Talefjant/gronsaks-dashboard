---
title: "Den store grønsaksutfordringa 2026"
format:
  html:
    theme: cosmo
    toc: true
execute:
  echo: false
  warning: false
  message: false
---

```{r}
library(tidyverse)
library(lubridate)
library(DT)
library(googlesheets4)

```


1) Data (dummy - byt ut med kobling til regnearket)
```{r}
# KODE: limer inn dataene dine som tekst

raw_txt <- "
Veke\tDato\tDag\tSigrun\tKnut_Olav\tTale\tMarleny\tMarianne
2\t05.01\tMandag\t4\t6\t7\t3\t8
2\t06.01\ttirsdag\t5\t5\t5\t6\t7
2\t07.01\tonsdag\t7\t6\t3\t5\t6
2\t08.01\ttorsdag\t8\t4\t4\t4\t4
2\t09.01\tfredag\t3\t8\t6\t8\t3
2\t10.01\tlørdag\t6\t7\t5\t7\t5
2\t11.01\tsøndag\t5\t6\t4\t6\t6
3\t12.01\tmandag\t\t\t\t\t
3\t13.01\ttirsdag\t\t\t\t\t
3\t14.01\tonsdag\t\t\t\t\t
3\t15.01\ttorsdag\t\t\t\t\t
3\t16.01\tfredag\t\t\t\t\t
3\t17.01\tlørdag\t\t\t\t\t
3\t18.01\tsøndag\t\t\t\t\t
4\t19.01\tmandag\t\t\t\t\t
4\t20.01\ttirsdag\t\t\t\t\t
4\t21.01\tonsdag\t\t\t\t\t
4\t22.01\ttorsdag\t\t\t\t\t
4\t23.01\tfredag\t\t\t\t\t
4\t24.01\tlørdag\t\t\t\t\t
4\t25.01\tsøndag\t\t\t\t\t
5\t26.01\tmandag\t\t\t\t\t
5\t27.01\ttirsdag\t\t\t\t\t
5\t28.01\tonsdag\t\t\t\t\t
5\t29.01\ttorsdag\t\t\t\t\t
5\t30.01\tfredag\t\t\t\t\t
5\t31.01\tlørdag\t\t\t\t\t
5\t01.02\tsøndag\t\t\t\t\t
6\t02.02\tmandag\t\t\t\t\t
6\t03.02\ttirsdag\t\t\t\t\t
6\t04.02\tonsdag\t\t\t\t\t
6\t05.02\ttorsdag\t\t\t\t\t
6\t06.02\tfredag\t\t\t\t\t
6\t07.02\tlørdag\t\t\t\t\t
6\t08.02\tsøndag\t\t\t\t\t
"

# KODE: leser teksten inn som tabell

df_wide <- read.delim(
text = raw_txt,
sep = "\t",
stringsAsFactors = FALSE,
check.names = FALSE
)

# KODE: rydder dato og typer

# OBS: her antar vi at dette gjelder år 2026

df_wide <- df_wide |>
mutate(
Veke = as.integer(Veke),
Dato = dmy(paste0(Dato, ".2026")),
Dag  = str_to_title(Dag)
)

# KODE: gjør data "lang" (en rad per person per dag)

df_long <- df_wide |>
pivot_longer(
cols = c("Sigrun", "Knut_Olav", "Tale", "Marleny", "Marianne"),
names_to = "Person",
values_to = "Score"
) |>
mutate(
Score = suppressWarnings(as.numeric(Score))
)

```


```{r}
# KODE: beregner KPI-er

kpi_total <- sum(df_long$Score)
kpi_snitt <- mean(df_long$Score)
kpi_max   <- max(df_long$Score)
kpi_dager <- n_distinct(df_long$Dato)

```


```{r}

df_long |>
ggplot(aes(x = Dato, y = fct_rev(Person), fill = Score)) +
geom_tile() +
scale_fill_gradientn(
  colours = c("#5A2A5E", "gold", "green")) +
labs(x = NULL, y = NULL, fill = "Grønsakspoeng") +
scale_x_date(date_labels = "%d.%m", date_breaks = "3 days") +
theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

Trend per uke
```{r}
# KODE: trend

df_long |>
  group_by(Veke, Person) |>
  summarise(Ukesum = sum(Score), .groups = "drop") |>
  ggplot(aes(x = Veke, y = Ukesum, color = Person)) +
  geom_line(linewidth = 1) +
  geom_point(size = 2) +
  scale_color_manual(
    values = c(
      "Sigrun"    = "#00B4D8",
      "Knut_Olav" = "#5A4FCF",
      "Tale"      = "#1B7F79",
      "Marleny"   = "#9B5DE5",
      "Marianne"  = "#4A6FA5"
    )
  ) +
  labs(
    x = "Veke",
    y = "Grønsakspoeng",
    color = "Deltakar"
  ) +
  theme_classic() +
  theme(
  legend.position = "bottom",
  legend.title = element_text(size = 10),
  legend.text  = element_text(size = 9)
)



```

```{r}
# KODE: interaktiv tabell

datatable(
df_wide,
options = list(pageLength = 10, scrollX = TRUE),
rownames = FALSE
)

```

```{r}
## Kumulativ score over tid

df_long |>
  arrange(Person, Dato) |>
  group_by(Person) |>
  mutate(Kumulativ = cumsum(Score)) |>
  ggplot(aes(x = Dato, y = Kumulativ, color = Person)) +
  geom_line(linewidth = 1) +
  geom_point(size = 1.8) +
  scale_color_manual(
    values = c(
      "Sigrun"    = "#00B4D8",
      "Knut_Olav" = "#5A4FCF",
      "Tale"      = "#1B7F79",
      "Marleny"   = "#9B5DE5",
      "Marianne"  = "#4A6FA5"
    )
  ) +
  labs(
    x = "Dato",
    y = "Kumulativ poengsum",
    color = "Deltakar"
  ) +
  theme_classic() +
  theme(
    legend.position = "bottom",
    axis.text.x = element_text(angle = 45, hjust = 1)
  )

```

```{r}
## Fordeling av score per deltakar

ggplot(df_long, aes(x = Person, y = Score, fill = Person)) +
  geom_boxplot(width = 0.6, alpha = 0.85, outlier.size = 1.5) +
  scale_fill_manual(
    values = c(
      "Sigrun"    = "#00B4D8",
      "Knut_Olav" = "#5A4FCF",
      "Tale"      = "#1B7F79",
      "Marleny"   = "#9B5DE5",
      "Marianne"  = "#4A6FA5"
    )
  ) +
  labs(
    x = NULL,
    y = "Grønsakspoeng"
  ) +
  theme_classic() +
  theme(
    legend.position = "none"
  )

```

```{r}
df_long |> summarise(
  rader = n(),
  ikkje_na_score = sum(!is.na(Score)),
  ikkje_na_dag = sum(!is.na(Dag))
)

df_long |> count(Dag, sort = TRUE)

df_long |> filter(Veke == 2) |> summarise(
  rader = n(),
  ikkje_na_score = sum(!is.na(Score)),
  min = min(Score, na.rm = TRUE),
  max = max(Score, na.rm = TRUE)
)

```


```{r}
## Snittscore per ukedag

tmp <- df_long |>
  mutate(
    Dag = stringr::str_trim(Dag),
    Dag = stringr::str_to_title(Dag),
    Dag = factor(Dag, levels = c("Mandag","Tirsdag","Onsdag","Torsdag","Fredag","Lørdag","Søndag"))
  ) |>
  filter(!is.na(Score)) |>
  group_by(Dag) |>
  summarise(Snitt = mean(Score), .groups = "drop") |>
  filter(!is.na(Snitt)) |>
  droplevels()

ggplot(tmp, aes(x = Dag, y = Snitt)) +
  geom_col(width = 0.7, fill = "#00B4D8") +
  labs(x = NULL, y = "Gjennomsnittleg score") +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 30, hjust = 1))



```

